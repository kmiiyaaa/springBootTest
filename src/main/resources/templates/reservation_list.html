<!-- src/main/resources/templates/reservation_list.html -->
<html layout:decorate="~{layout}">
<div layout:fragment="content">
		
	<h3 class="rlist-title">ì˜ˆì•½ ë¦¬ìŠ¤íŠ¸</h3> 

	<table class="rlist-table">
		<thead>
			<tr>
				<th>ë²ˆí˜¸</th>
				<th>ì˜ˆì•½ì</th>
				<th>ì˜ˆì•½ì¼ì‹œ</th>
				<th>ìˆ˜ì •/ì‚­ì œ</th>
			</tr>
		</thead>
		<tbody>
			<tr th:each="reservation, loop : ${reservations}">
			    <td th:text="${reservations.getTotalElements - (reservations.number*reservations.size) - loop.index}"></td>
			    <td th:text="${reservation.user != null ? reservation.user.username : ''}"></td>
			    <td th:text="${#temporals.format(reservation.rtime, 'yyyy-MM-dd HH:mm')}"></td>
			    <td>
			       <div class="action-btns">
			       <a th:href="@{|/reservation/modify/${reservation.id}|}"
			       	sec:authorize="isAuthenticated()"
			       	th:if="${reservation.user != null and #authentication.getName() == reservation.user.username}"
			       	class="modify-btn">
			    	 ìˆ˜ì •
				     </a>
				     <a th:href="@{|/reservation/delete/${reservation.id}|}"
				        sec:authorize="isAuthenticated()"
				       th:if="${reservation.user != null and #authentication.getName() == reservation.user.username}"
				       class="delete-btn">
				    	 ì‚­ì œ
				    </a>
			    </div>
			    </td>
			 </tr>
		</tbody>
	</table>
	
  <!-- í˜ì´ì§•ìš© í¼ -->
<form id="pageForm" method="get" th:action="@{/reservation/list}">
    <input type="hidden" id="page" name="page" value="0">
</form>

<!-- í˜ì´ì§• -->
<div class="board-pagination">
    <ul>
        <!-- << (ì´ì „ ê·¸ë£¹) -->
        <li th:if="${hasPrevGroup}">
            <a class="page-link" href="javascript:void(0)" th:data-page="${startPage - 1}">Â«</a>
        </li>

        <!-- ì´ì „ -->
        <li th:if="${reservations.hasPrevious}">
            <a class="page-link" href="javascript:void(0)" th:data-page="${reservations.number - 1}">ì´ì „</a>
        </li>

        <!-- ê·¸ë£¹ í˜ì´ì§€ ë²ˆí˜¸ -->
        <li th:each="page : ${#numbers.sequence(startPage, endPage)}"
            th:classappend="${page == reservations.number} ? 'active'">
            <a class="page-link"
               href="javascript:void(0)"
               th:data-page="${page}"
               th:text="${page + 1}"></a>
        </li>

        <!-- ë‹¤ìŒ -->
        <li th:if="${reservations.hasNext}">
            <a class="page-link" href="javascript:void(0)" th:data-page="${reservations.number + 1}">ë‹¤ìŒ</a>
        </li>

        <!-- >> (ë‹¤ìŒ ê·¸ë£¹) -->
        <li th:if="${hasNextGroup}">
            <a class="page-link" href="javascript:void(0)" th:data-page="${endPage + 1}">Â»</a>
        </li>
    </ul>
</div>
	     
    </div>

	<!-- ìŠ¤í¬ë¦½íŠ¸ -->
	<script layout:fragment="script" type="text/javascript">
	    const pageLinks = document.querySelectorAll(".page-link");
	    pageLinks.forEach(link => {
	        link.addEventListener("click", function () {
	            document.getElementById("page").value = this.dataset.page;
	            document.getElementById("pageForm").submit(); // ğŸš€ ì´ë™
	        });
	    });
	</script>  
</html>
