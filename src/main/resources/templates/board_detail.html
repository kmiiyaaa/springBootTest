<html layout:decorate="~{layout}">
<div layout:fragment="content">
	
	<h1 th:text="${board.btitle}"></h1>
	<div><span th:if="${board.author} != null" th:text="${board.author.username}"></span></div>
	<div th:text="${board.bcontent}"></div>
	<div th:text="${#temporals.format(board.bdate.atZone(T(java.time.ZoneId).of('UTC'))
                                        .withZoneSameInstant(T(java.time.ZoneId).of('Asia/Seoul')),
                                        'yyyy-MM-dd HH:mm')}">댓글 등록일</div>
	<div>
		<a th:href="@{|/board/modify/${board.bnum}|}" sec:authorize="isAuthenticated()" 
		th:if="${board.author != null and #authentication.getPrincipal.getUsername() ==
		board.author.username}" th:text="수정"></a>
		<a th:href="@{|/board/delete/${board.bnum}|}" class="delete" sec:authorize="isAuthenticated()" 
		th:if="${board.author != null and #authentication.getPrincipal.getUsername() ==
		board.author.username}" th:text="삭제"></a>
	</div>
	<hr>
	
	<!--댓글 갯수 -->
		<h5 th:text="|${#lists.size(board.answerList)}개의 답변이 있습니다.|">답변 갯수</h5>
		
	<!-- 댓글들(반복) -->
	<div th:each="answer : ${board.answerList}">
    <a th:id="|answer_${answer.id}|"></a>
    <div>
        <div th:text="${answer.acontent}">답변글 내용</div>
        <div>
            <div>
                <span th:if="${board.author != null}" th:text="${board.author.username}"></span>
            </div>			
            <div th:text="${#temporals.format(answer.adate.atZone(T(java.time.ZoneId).of('UTC'))
                                        .withZoneSameInstant(T(java.time.ZoneId).of('Asia/Seoul')),
                                        'yyyy-MM-dd HH:mm')}">댓글 등록일</div>
	        </div>
			
	    </div>
	</div>

	<!-- 답변 작성 -->
		<form th:action="@{|/answer/create/${board.bnum}|}" th:object="${answerForm}" method="post"> 
			<div th:replace="~{form_errors :: formErrorsFragment}"></div>
			<textarea sec:authorize="isAnonymous()" disabled 
			th:field="*{acontent}" rows="10"></textarea>
			<textarea sec:authorize="isAuthenticated()" th:field="*{acontent}" rows="10"></textarea>
			<input type="submit" value="댓글 등록">
		</form>	
</div>
	<script layout:fragment="script" type='text/javascript'>
	const delete_elements = document.getElementsByClassName("delete");
	Array.from(delete_elements).forEach(function (element) {
		element.addEventListener('click', function () {
			if (confirm("정말로 삭제하시겠습니까?")) {
				location.href = this.dataset.uri;
			};
		});
	});
	</script>
</html>